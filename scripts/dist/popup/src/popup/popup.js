var Ve=Object.defineProperty;var Xe=(U,w,R)=>w in U?Ve(U,w,{enumerable:!0,configurable:!0,writable:!0,value:R}):U[w]=R;var ge=(U,w,R)=>(Xe(U,typeof w!="symbol"?w+"":w,R),R);(function(){"use strict";var U=document.createElement("style");U.textContent=`.page.svelte-1fs78nu{display:grid;gap:20px;grid-template-columns:3fr 1fr}.operations.svelte-1fs78nu{display:flex;width:100%;gap:5px}.button.svelte-1fs78nu{background-color:#fff;width:2em;height:2em;display:flex;justify-content:center;align-items:center}.icon.svelte-1fs78nu{width:80%;height:80%}
`,document.head.appendChild(U);function w(){}function R(e,t){for(const n in t)e[n]=t[n];return e}function se(e){return e()}function ie(){return Object.create(null)}function B(e){e.forEach(se)}function N(e){return typeof e=="function"}function V(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}let H;function X(e,t){return H||(H=document.createElement("a")),H.href=t,e===H.href}function ye(e){return Object.keys(e).length===0}function be(e,t,n,o){if(e){const r=le(e,t,n,o);return e[0](r)}}function le(e,t,n,o){return e[1]&&o?R(n.ctx.slice(),e[1](o(t))):n.ctx}function ke(e,t,n,o){if(e[2]&&o){const r=e[2](o(n));if(t.dirty===void 0)return r;if(typeof r=="object"){const c=[],s=Math.max(t.dirty.length,r.length);for(let u=0;u<s;u+=1)c[u]=t.dirty[u]|r[u];return c}return t.dirty|r}return t.dirty}function ve(e,t,n,o,r,c){if(r){const s=le(t,n,o,c);e.p(s,r)}}function we(e){if(e.ctx.length>32){const t=[],n=e.ctx.length/32;for(let o=0;o<n;o++)t[o]=-1;return t}return-1}function g(e,t){e.appendChild(t)}function F(e,t,n){e.insertBefore(t,n||null)}function L(e){e.parentNode&&e.parentNode.removeChild(e)}function k(e){return document.createElement(e)}function J(e){return document.createTextNode(e)}function x(){return J(" ")}function ce(){return J("")}function I(e,t,n,o){return e.addEventListener(t,n,o),()=>e.removeEventListener(t,n,o)}function y(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function Me(e){return Array.from(e.childNodes)}function Ee(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}let W;function z(e){W=e}function Le(){if(!W)throw new Error("Function called outside component initialization");return W}function Oe(e){Le().$$.on_mount.push(e)}const q=[],ue=[],K=[],fe=[],Se=Promise.resolve();let Y=!1;function Ce(){Y||(Y=!0,Se.then(ae))}function Z(e){K.push(e)}const ee=new Set;let T=0;function ae(){if(T!==0)return;const e=W;do{try{for(;T<q.length;){const t=q[T];T++,z(t),Fe(t.$$)}}catch(t){throw q.length=0,T=0,t}for(z(null),q.length=0,T=0;ue.length;)ue.pop()();for(let t=0;t<K.length;t+=1){const n=K[t];ee.has(n)||(ee.add(n),n())}K.length=0}while(q.length);for(;fe.length;)fe.pop()();Y=!1,ee.clear(),z(e)}function Fe(e){if(e.fragment!==null){e.update(),B(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(Z)}}const G=new Set;let $;function de(){$={r:0,c:[],p:$}}function pe(){$.r||B($.c),$=$.p}function P(e,t){e&&e.i&&(G.delete(e),e.i(t))}function j(e,t,n,o){if(e&&e.o){if(G.has(e))return;G.add(e),$.c.push(()=>{G.delete(e),o&&(n&&e.d(1),o())}),e.o(t)}else o&&o()}function Ae(e,t){j(e,1,1,()=>{t.delete(e.key)})}function Ue(e,t,n,o,r,c,s,u,i,f,l,m){let _=e.length,b=c.length,h=_;const E={};for(;h--;)E[e[h].key]=h;const v=[],O=new Map,M=new Map;for(h=b;h--;){const p=m(r,c,h),S=n(p);let C=s.get(S);C?o&&C.p(p,t):(C=f(S,p),C.c()),O.set(S,v[h]=C),S in E&&M.set(S,Math.abs(h-E[S]))}const A=new Set,a=new Set;function d(p){P(p,1),p.m(u,l),s.set(p.key,p),l=p.first,b--}for(;_&&b;){const p=v[b-1],S=e[_-1],C=p.key,Q=S.key;p===S?(l=p.first,_--,b--):O.has(Q)?!s.has(C)||A.has(C)?d(p):a.has(Q)?_--:M.get(C)>M.get(Q)?(a.add(C),d(p)):(A.add(Q),_--):(i(S,s),_--)}for(;_--;){const p=e[_];O.has(p.key)||i(p,s)}for(;b;)d(v[b-1]);return v}function me(e){e&&e.c()}function te(e,t,n,o){const{fragment:r,after_update:c}=e.$$;r&&r.m(t,n),o||Z(()=>{const s=e.$$.on_mount.map(se).filter(N);e.$$.on_destroy?e.$$.on_destroy.push(...s):B(s),e.$$.on_mount=[]}),c.forEach(Z)}function ne(e,t){const n=e.$$;n.fragment!==null&&(B(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function xe(e,t){e.$$.dirty[0]===-1&&(q.push(e),Ce(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function oe(e,t,n,o,r,c,s,u=[-1]){const i=W;z(e);const f=e.$$={fragment:null,ctx:[],props:c,update:w,not_equal:r,bound:ie(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(i?i.$$.context:[])),callbacks:ie(),dirty:u,skip_bound:!1,root:t.target||i.$$.root};s&&s(f.root);let l=!1;if(f.ctx=n?n(e,t.props||{},(m,_,...b)=>{const h=b.length?b[0]:_;return f.ctx&&r(f.ctx[m],f.ctx[m]=h)&&(!f.skip_bound&&f.bound[m]&&f.bound[m](h),l&&xe(e,m)),_}):[],f.update(),l=!0,B(f.before_update),f.fragment=o?o(f.ctx):!1,t.target){if(t.hydrate){const m=Me(t.target);f.fragment&&f.fragment.l(m),m.forEach(L)}else f.fragment&&f.fragment.c();t.intro&&P(e.$$.fragment),te(e,t.target,t.anchor,t.customElement),ae()}z(i)}class re{$destroy(){ne(this,1),this.$destroy=w}$on(t,n){if(!N(n))return w;const o=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return o.push(n),()=>{const r=o.indexOf(n);r!==-1&&o.splice(r,1)}}$set(t){this.$$set&&!ye(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const Pe=e=>Array.isArray(e)?e.every(n=>typeof n=="string"):!1,Re=""+new URL("allow_back.svg",document.currentScript&&document.currentScript.src||document.baseURI).href,Be=""+new URL("allow_front.svg",document.currentScript&&document.currentScript.src||document.baseURI).href,Ne=""+new URL("unpin.svg",document.currentScript&&document.currentScript.src||document.baseURI).href,Ye="";function $e(e){let t,n,o,r,c,s,u,i,f,l,m,_,b,h,E,v,O,M;const A=e[4].default,a=be(A,e,e[3],null);return{c(){t=k("li"),n=k("div"),a&&a.c(),o=x(),r=k("div"),c=k("button"),s=k("img"),i=x(),f=k("button"),l=k("img"),_=x(),b=k("button"),h=k("img"),y(n,"class","page-name"),X(s.src,u=Re)||y(s,"src",u),y(s,"class","icon svelte-1fs78nu"),y(s,"alt","前に移動する"),y(c,"type","button"),y(c,"class","button button-move-front svelte-1fs78nu"),X(l.src,m=Be)||y(l,"src",m),y(l,"class","icon svelte-1fs78nu"),y(l,"alt","後ろに移動する"),y(f,"type","button"),y(f,"class","button button-move-back svelte-1fs78nu"),X(h.src,E=Ne)||y(h,"src",E),y(h,"class","icon svelte-1fs78nu"),y(h,"alt","ピン留めから削除する"),y(b,"type","button"),y(b,"class","button button-unpin svelte-1fs78nu"),y(r,"class","operations svelte-1fs78nu"),y(t,"class","page svelte-1fs78nu")},m(d,p){F(d,t,p),g(t,n),a&&a.m(n,null),g(t,o),g(t,r),g(r,c),g(c,s),g(r,i),g(r,f),g(f,l),g(r,_),g(r,b),g(b,h),v=!0,O||(M=[I(c,"click",function(){N(e[0]())&&e[0]().apply(this,arguments)}),I(f,"click",function(){N(e[1]())&&e[1]().apply(this,arguments)}),I(b,"click",function(){N(e[2]())&&e[2]().apply(this,arguments)})],O=!0)},p(d,[p]){e=d,a&&a.p&&(!v||p&8)&&ve(a,A,e,e[3],v?ke(A,e[3],p,null):we(e[3]),null)},i(d){v||(P(a,d),v=!0)},o(d){j(a,d),v=!1},d(d){d&&L(t),a&&a.d(d),O=!1,B(M)}}}function je(e,t,n){let{$$slots:o={},$$scope:r}=t;Oe(()=>{console.log(document.currentScript),console.log(document.baseURI)});let{onMoveFront:c}=t,{onMoveBack:s}=t,{onUnpin:u}=t;return e.$$set=i=>{"onMoveFront"in i&&n(0,c=i.onMoveFront),"onMoveBack"in i&&n(1,s=i.onMoveBack),"onUnpin"in i&&n(2,u=i.onUnpin),"$$scope"in i&&n(3,r=i.$$scope)},[c,s,u,r,o]}class Ie extends re{constructor(t){super(),oe(this,t,je,$e,V,{onMoveFront:0,onMoveBack:1,onUnpin:2})}}function he(e,t,n){const o=e.slice();return o[7]=t[n],o[9]=n,o}function qe(e){let t=e[7]+"",n,o;return{c(){n=J(t),o=x()},m(r,c){F(r,n,c),F(r,o,c)},p(r,c){c&1&&t!==(t=r[7]+"")&&Ee(n,t)},d(r){r&&L(n),r&&L(o)}}}function _e(e,t){let n,o,r;function c(){return t[4](t[9])}function s(){return t[5](t[9])}function u(){return t[6](t[9])}return o=new Ie({props:{onMoveBack:c,onMoveFront:s,onUnpin:u,$$slots:{default:[qe]},$$scope:{ctx:t}}}),{key:e,first:null,c(){n=ce(),me(o.$$.fragment),this.first=n},m(i,f){F(i,n,f),te(o,i,f),r=!0},p(i,f){t=i;const l={};f&9&&(l.onMoveBack=c),f&9&&(l.onMoveFront=s),f&9&&(l.onUnpin=u),f&1025&&(l.$$scope={dirty:f,ctx:t}),o.$set(l)},i(i){r||(P(o.$$.fragment,i),r=!0)},o(i){j(o.$$.fragment,i),r=!1},d(i){i&&L(n),ne(o,i)}}}function Te(e){let t,n,o,r,c,s,u=[],i=new Map,f,l,m,_,b,h,E,v,O,M=e[0].names;const A=a=>a[7];for(let a=0;a<M.length;a+=1){let d=he(e,M,a),p=A(d);i.set(p,u[a]=_e(p,d))}return{c(){t=k("section"),t.innerHTML=`<h1>Scrapbox Pin Utility</h1> 
    <p>Scrapbox でのピン留めを自動的に入れ替えられます。</p>`,n=x(),o=k("section"),r=k("h2"),r.textContent="このプロジェクトのピン留めリスト",c=x(),s=k("ul");for(let a=0;a<u.length;a+=1)u[a].c();f=x(),l=k("p"),m=k("button"),m.textContent="実行する",_=x(),b=k("p"),h=k("button"),h.textContent="ピン留めリストをリロード",y(s,"class","page-list"),y(m,"type","button"),y(h,"type","button")},m(a,d){F(a,t,d),F(a,n,d),F(a,o,d),g(o,r),g(o,c),g(o,s);for(let p=0;p<u.length;p+=1)u[p].m(s,null);g(o,f),g(o,l),g(l,m),g(o,_),g(o,b),g(b,h),E=!0,v||(O=[I(m,"click",function(){N(e[2]())&&e[2]().apply(this,arguments)}),I(h,"click",function(){N(e[1]())&&e[1]().apply(this,arguments)})],v=!0)},p(a,[d]){e=a,d&9&&(M=e[0].names,de(),u=Ue(u,d,A,1,e,M,i,s,Ae,_e,null,he),pe())},i(a){if(!E){for(let d=0;d<M.length;d+=1)P(u[d]);E=!0}},o(a){for(let d=0;d<u.length;d+=1)j(u[d]);E=!1},d(a){a&&L(t),a&&L(n),a&&L(o);for(let d=0;d<u.length;d+=1)u[d].d();v=!1,B(O)}}}function We(e,t,n){let{input:o}=t;console.log(o);let{onReload:r}=t,{onExecute:c}=t,{onChange:s}=t;const u=l=>s(o.moveBack(l)),i=l=>s(o.moveFront(l)),f=l=>s(o.unpin(l));return e.$$set=l=>{"input"in l&&n(0,o=l.input),"onReload"in l&&n(1,r=l.onReload),"onExecute"in l&&n(2,c=l.onExecute),"onChange"in l&&n(3,s=l.onChange)},e.$$.update=()=>{e.$$.dirty&1},[o,r,c,s,u,i,f]}class ze extends re{constructor(t){super(),oe(this,t,We,Te,V,{input:0,onReload:1,onExecute:2,onChange:3})}}class D{constructor(t){ge(this,"names");this.names=t,console.log(this.moveFront.toString())}copy(){return console.log(JSON.stringify(this)),new D([...this.names])}moveFront(t){if(t-1<0)return this;const n=this.copy();return[n.names[t-1],n.names[t]]=[n.names[t],n.names[t-1]],n}moveBack(t){if(t+1>=this.names.length)return this;const n=this.copy();return[n.names[t+1],n.names[t]]=[n.names[t],n.names[t+1]],n}unpin(t){return new D(this.names.filter((n,o)=>t!==o))}}const De=(e,t)=>{const n=[],o=[];let r=[...e.names];const c=[...t.names];let s=0,u=0;for(r.filter(i=>!c.includes(i)).forEach(i=>{console.log(i),o.push({type:"unpin",target:i})}),r=r.filter(i=>c.includes(i));s<c.length;){for(;u<r.length;)if(console.log(c[s],r[u],s,u),c[s]!==r[u])o.push({type:"unpin",target:r[u]}),n.push({type:"pin",target:r[u]}),u++;else{u++;break}s++}return[...o,...n]};function He(e){let t,n,o,r,c;return{c(){t=k("p"),n=J(`ピン留めページの一覧が読み込まれていません。

        `),o=k("button")},m(s,u){F(s,t,u),g(t,n),g(t,o),r||(c=I(o,"click",e[1]),r=!0)},p:w,i:w,o:w,d(s){s&&L(t),r=!1,c()}}}function Je(e){let t,n;return t=new ze({props:{input:e[0],onExecute:e[3],onReload:e[1],onChange:e[2]}}),{c(){me(t.$$.fragment)},m(o,r){te(t,o,r),n=!0},p(o,r){const c={};r&1&&(c.input=o[0]),t.$set(c)},i(o){n||(P(t.$$.fragment,o),n=!0)},o(o){j(t.$$.fragment,o),n=!1},d(o){ne(t,o)}}}function Ke(e){let t,n,o,r;const c=[Je,He],s=[];function u(i,f){return i[0]!==null?0:1}return t=u(e),n=s[t]=c[t](e),{c(){n.c(),o=ce()},m(i,f){s[t].m(i,f),F(i,o,f),r=!0},p(i,[f]){let l=t;t=u(i),t===l?s[t].p(i,f):(de(),j(s[l],1,1,()=>{s[l]=null}),pe(),n=s[t],n?n.p(i,f):(n=s[t]=c[t](i),n.c()),P(n,1),n.m(o.parentNode,o))},i(i){r||(P(n),r=!0)},o(i){j(n),r=!1},d(i){s[t].d(i),i&&L(o)}}}function Ge(e,t,n){let o=null,r=null;const c=!1,s=async()=>{const[l]=await chrome.tabs.query({active:!0,lastFocusedWindow:!0});if(console.log(l),(l==null?void 0:l.id)===void 0)return new D([]);const m=await chrome.tabs.sendMessage(l.id,{type:"get-page-name-list"});console.log(m);const _=Pe(m)?m:[];return console.log(_),new D(_)},u=async()=>{const l=await s();console.log(l.moveFront.toString()),o=l,n(0,r=l.copy())},i=l=>{n(0,r=l)},f=async()=>{if(o===null||r===null)return;const l=De(o,r);console.log(l);const[m]=await chrome.tabs.query({active:!0,lastFocusedWindow:!0});if(console.log(m),(m==null?void 0:m.id)!==void 0)for(const _ of l)await chrome.tabs.sendMessage(m.id,{type:"run-action",content:{action:_}})};return document.addEventListener("DOMContentLoaded",()=>{u()}),[r,u,i,f,c]}class Qe extends re{constructor(t){super(),oe(this,t,Ge,Ke,V,{csr:4})}get csr(){return this.$$.ctx[4]}}document.addEventListener("DOMContentLoaded",()=>{console.warn("loaded"),new Qe({target:document.getElementById("app")})})})();
